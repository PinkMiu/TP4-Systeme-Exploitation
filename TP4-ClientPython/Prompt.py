import sys
class Prompt:

    def __init__(self, client, invite_pattern = ">>"):
        self.invite_pattern = invite_pattern
        self.client = client
        self.startPrompt()

    def invite(self, message):
        answer = input(message)
        return answer

    def processCommand(self, input):
       temp = input.split(" ")
       command = temp[0]
       return command

    def getParameter(self, input):
        temp = input.split(" ")
        parameter = temp[1]
        return parameter

    def startPrompt(self):
        while True:
            answer = self.invite(self.invite_pattern)

            command = self.processCommand(answer)

            if (command == 'connecter?'):
                clientAnswer = self.client.bonjour()
                if (clientAnswer == 'bonjourClient'):
                    toPrint = 'Oui'
                else:
                    toPrint = 'Une erreur est survenue'
                    sys.exit(1)

            elif (command == 'nomServeur?'):
                toPrint = self.client.serverName()

            elif (command == 'listeDossier?'):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.folderList(parameter)

                if (clientAnswer == 'erreurDossierInexistant'):
                    toPrint = 'Dossier inexistant'

                elif (clientAnswer == 'erreurDossierLecture'):
                    toPrint = 'Une erreur est survenue, le dossier est en lecture actuellement.'

                elif (clientAnswer == ""):
                    toPrint = "Le dossier n'a aucun sous-dossier."

                else:
                    toPrint = clientAnswer

            elif (command == 'dossier?'):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.folderExist(parameter)

                if (clientAnswer == True):
                    toPrint = 'Oui'
                else:
                    toPrint = 'Non'

            elif (command == 'creerDossier?'):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.createFolder(parameter)

                if (clientAnswer == 'ok'):
                    toPrint = 'ok'

                elif (clientAnswer == 'erreurDossierExiste'):
                    toPrint = 'Dossier existe.'

                elif (clientAnswer == 'erreurDossierInexistant'):
                    toPrint = "Certain dossiers dans cette commande sont inexistant. Créer ces dossiers d'abord."

            elif (command == 'supprimerDossier?'):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.deleteFolder(parameter)

                if (clientAnswer == 'ok'):
                    toPrint = 'ok'
                elif (clientAnswer == 'erreurDossierInexistant'):
                    toPrint = 'Dossier inexistant'
                else:
                    toPrint = 'Une erreur est survenue, le dossier est en lecture actuellement.'

            elif (command == 'listeFichier?'):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.fileList(parameter)

                if (clientAnswer == 'erreurDossierInexistant'):
                    toPrint = 'Le dossier est inexistant ou ne contient aucun fichier.'

                elif (clientAnswer == 'erreurDossierLecture'):
                    toPrint = 'Une erreur est survenue, le dossier est en lecture actuellement.'

                else:
                    toPrint = clientAnswer

            elif (command == 'fichier?'):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.fileExist(parameter)

                if (clientAnswer == True):
                    toPrint = 'Oui'
                else:
                    toPrint = 'Non'

            elif (command == 'supprimerFichier?'):
                parameter = self.getParameter(answer)
                clientAnswer= self.client.deleteFile(parameter)

                if (clientAnswer == 'ok'):
                    toPrint = 'ok'
                elif (clientAnswer == 'erreurDossierInexistant'):
                    toPrint = 'Dossier inexistant'
                elif (clientAnswer == 'erreurFichierInexistant'):
                    toPrint = 'Fichier inexistant'
                else:
                    toPrint = 'Une erreur est survenue, le dossier est en lecture actuellement.'

            elif (command == 'fichierIdentique?'):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.identicalFile(parameter)

                if (clientAnswer == 'erreurFichierInexistant'):
                    toPrint = "Ce fichier n'existe pas sur le serveur."
                elif (clientAnswer == 'oui'):
                    toPrint = 'oui'
                elif (clientAnswer == 'non'):
                    toPrint = 'non'
                else:
                    toPrint = 'Une erreur est survenue, le fichier est en lecture actuellement.'

            elif (command == 'fichierRecent?' or command == "recentFichier?"):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.recentFile(parameter)

                if (clientAnswer == 'erreurFichierInexistant'):
                    toPrint = "Ce fichier n'existe pas sur le serveur."
                elif (clientAnswer == 'oui'):
                    toPrint = 'oui'
                elif (clientAnswer == 'non'):
                    toPrint = 'non'
                else:
                    toPrint = 'Une erreur est survenue, le fichier est en lecture actuellement.'

            elif (command == 'televerser?'):
                parameter = self.getParameter(answer)
                toPrint = self.client.upload(parameter)

                if (clientAnswer == "ok"):
                    toPrint = "Fichier telecharge"
                elif (clientAnswer == "erreurFichierExiste"):
                    toPrint = "Ce fichier existe sur le serveur."
                elif (clientAnswer == "erreurDossierInexistant"):
                    toPrint = 'Dossier inexistant'
                else:
                    toPrint = 'Il y a erreur avec la signature. Televersement echoue.'

            elif (command == 'telecharger?'):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.download(parameter)

                if (clientAnswer == "ok"):
                    toPrint = "Fichier telecharge"
                elif (clientAnswer == 'erreurFichierInexistant'):
                    toPrint = "Ce fichier n'existe pas sur le serveur."
                else:
                    toPrint = 'Une erreur est survenue, le fichier est en lecture actuellement.'

            elif (command == 'miseAjour?'):
                parameter = self.getParameter(answer)
                clientAnswer = self.client.update(parameter)

                if (clientAnswer == True):
                    toPrint = "ok"
                else:
                    toPrint = "La mise à jour a échoué, une erreur s'est produite."

            elif (command == 'quitter' or 'quit' or 'exit' or 'bye'):
                clientAnswer = self.client.quit()
                if (clientAnswer == 'bye'):
                    toPrint = "bye"
            else:
                toPrint = 'Commande invalide'


            print(toPrint)
